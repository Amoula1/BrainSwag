<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="Open, collaborative platform for a human-curated classification of the neuroimaging literature">
        <meta name="keywords" content="Open science, Collaboration, Neuroimaging, Cognitive science, Neuroscience, Annotation, Meta-analysis">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame. -->
        <title>BrainSwag</title>
        <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
        <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
        <link rel="stylesheet" type="text/css" href="/css/style.css">
        <script src="/js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript">
            // Is JS enabled? Is it a touch device?
            var init = function () {
                var htmlTag = document.getElementsByTagName('html')[0];
                htmlTag.className = (htmlTag.className + ' ' || '') + 'hasJS';
                if ('ontouchstart' in document.documentElement)
                    htmlTag.className = (htmlTag.className + ' ' || '') + 'isTouch';
            }();
        </script>
    </head>

    <body>
        <div class="wrap">
            <div class="content">
                <!-- Logo and navigation bar -->
                <div class="header">
                </div><!-- /header -->
                <script>
                    var collections = [];
                    function updateCollections() {
                        console.log("[updateCollections] display user's article collections");
                        if (collections.length == 0)
                            return;
                        // Display article list button
                        // remove old
                        $("#collections").remove();
                        // append new
                        var li = $("<li id='collections'>");
                        var icon = $("<img src='/img/collection-icon.svg'/>");
                        li.append(icon);
                        li.append(" (" + collections.length + " list" + ((collections.length > 1) ? "s" : "") + ")");
                        $("ul.fr").find(".login").after(li);
                        icon.click(function () {
                            if (collections.length == 0)
                                return;
                            // create overlay
                            var overlay = $("<div>");
                            overlay.html(" ");
                            overlay.css({position: "fixed", top: 0, left: 0, width: "100%", height: "100%", zIndex: 9});
                            overlay.click(function () {
                                overlay.remove();
                                win.remove();
                            });
                            $("body").append(overlay);
                            // create dialog box
                            var win = $("<div>");
                            var con = ["<div style='padding:5'>"];
                            var height = icon.height();
                            var pos = icon.offset();
                            for (var i = 0; i < collections.length; i++) {
                                var c = [
                                    "<img class='collection-delete' src='/img/minus-circle.svg'/>",
                                    "<a style='vertical-align:middle' class='old-collection'>" + collections[i].name + "</a><br/>"
                                ].join("");
                                con = con.concat(c);
                            }
                            con = con.concat(["</div>"]);
                            win.append(con.join("\n"));
                            win.css({position: "absolute", top: height + 5, left: 0, width: 200, textAlign: "left", border: "thin solid lightGrey", boxShadow: "2px 2px 10px rgba(0,0,0,.7)", background: "white", zIndex: 10});
                            icon.parent().css("position", "relative");
                            icon.parent().append(win);
                            // action
                            win.find("img.collection-delete").click(function (e) {
                                e.stopPropagation();
                                var a = $(this).next("a");
                                var b = a.next("br");
                                var collectionName = a.text();
                                for (var i = 0; i < collections.length; i++) {
                                    if (collections[i].name == collectionName) {
                                        collections.splice(i, 1);
                                        $(this).remove();
                                        a.remove();
                                        b.remove();
                                        logCollections(); // update collection in DB
                                        update_user();
                                        break;
                                    }
                                }
                            });
                            win.find("a.old-collection").click(function (e) {
                                e.stopPropagation();
                                var collectionName = $(this).text();
                                for (var i = 0; i < collections.length; i++) {
                                    if (collections[i].name == collectionName) {
                                        $(location).attr('href', location.origin + '/list?articles=' + JSON.stringify(collections[i].articles));
                                    }
                                }
                                win.remove();
                                overlay.remove();
                            });
                        });
                    }
                </script>
                <!-- Main content  -->
                <!--Core-->

            </div><!-- /content -->
        </div><!-- /wrap -->
    </body>
</html>
